# Fixtures

This directory is for upstream Ergogen fixtures (YAML/JSON inputs) and their corresponding golden outputs used to validate behavioral equivalence during the Rust migration.

## Provenance

When fixtures are imported, record:

- The upstream repository URL
- The exact upstream commit hash
- The subset of fixtures copied and any modifications made for this repo

## Imported Fixtures

### M1

- `fixtures/m1/minimal.yaml`: local minimal fixture for units parsing.

### M2

- Upstream repo: `git@github.com:ergogen/ergogen.git`
- Upstream commit: `8286e18f18ac064aa6d2ebca9c449bf2f6ba4d37`
- Source directory: `test/points/`
- Imported inputs:
  - `fixtures/m2/upstream/points_default.yaml`
  - `fixtures/m2/upstream/points_units.yaml`
  - `fixtures/m2/upstream/points_overrides.yaml`
  - `fixtures/m2/upstream/points_mirrors.yaml`
  - `fixtures/m2/upstream/points_rotations.yaml`
- Canonical snapshots (generated by `cargo run -p ergogen-parser --example prepare -- <yaml>`):
  - `fixtures/m2/upstream/*.canonical.json`

### M3

- Upstream repo: `git@github.com:ergogen/ergogen.git`
- Upstream commit: `8286e18f18ac064aa6d2ebca9c449bf2f6ba4d37`
- Source directory: `test/points/`
- Imported fixtures + references:
  - `fixtures/m3/points/*.yaml`
  - `fixtures/m3/points/*___points.json`
  - `fixtures/m3/points/*___units.json`
  - `fixtures/m3/points/*___EXCEPTION.txt`
  - `fixtures/m3/points/*___*.dxf` (not asserted by the Rust tests yet)

### M5

- Upstream repo: `git@github.com:ergogen/ergogen.git`
- Upstream commit: `8286e18f18ac064aa6d2ebca9c449bf2f6ba4d37`
- Source directory: `test/outlines/`
- Imported fixtures + references:
  - `fixtures/m5/outlines/*.yaml`
  - `fixtures/m5/outlines/*___outlines_*_dxf.dxf` (currently parsed/normalized by `ergogen-export` tests; semantic compare comes in M6)

### M6

- Local fixture covering injected footprint PCB output:
  - `fixtures/m6/pcbs/injected.yaml`
  - `fixtures/m6/pcbs/injected___pcbs_pcb.kicad_pcb`
- Local fixture covering MX/Choc variants + asymmetry:
  - `fixtures/m6/pcbs/mx_choc_asym.yaml`
  - `fixtures/m6/pcbs/mx_choc_asym___pcbs_pcb.kicad_pcb`
- Additional footprint fixtures:
  - `fixtures/m6/pcbs/trrs_rotary_promicro.yaml`
  - `fixtures/m6/pcbs/trrs_rotary_promicro___pcbs_pcb.kicad_pcb`
  - `fixtures/m6/pcbs/pad_button_chocmini.yaml`
  - `fixtures/m6/pcbs/pad_button_chocmini___pcbs_pcb.kicad_pcb`
  - `fixtures/m6/pcbs/oled_rgb_scrollwheel_slider.yaml`
  - `fixtures/m6/pcbs/oled_rgb_scrollwheel_slider___pcbs_pcb.kicad_pcb`
  - `fixtures/m6/pcbs/alps_jumper_omron_via.yaml`
  - `fixtures/m6/pcbs/alps_jumper_omron_via___pcbs_pcb.kicad_pcb`
- Reference outputs (goldens) from `fixtures/upstream/fixtures/big.yaml`:
  - `fixtures/m6/reference_outputs/big/outlines/export.dxf`
  - `fixtures/m6/reference_outputs/big/outlines/export.svg`
  - `fixtures/m6/reference_outputs/big/cases/export.jscad`
  - `fixtures/m6/reference_outputs/big/pcbs/export.kicad_pcb`
  - `fixtures/m6/pcbs/scrollwheel_slider_front.yaml`
  - `fixtures/m6/pcbs/scrollwheel_slider_front___pcbs_pcb.kicad_pcb`
  - `fixtures/m6/pcbs/oled_rgb_mirror.yaml`
  - `fixtures/m6/pcbs/oled_rgb_mirror___pcbs_pcb.kicad_pcb`

### M7

- Declarative footprint spec fixture (schema proof of concept):
  - `fixtures/m7/footprints/pad_minimal.yaml`
  - `fixtures/m7/footprints/pad_templated.yaml`
  - `fixtures/m7/footprints/pad_missing_placeholder.yaml`
  - `fixtures/m7/footprints/pad_primitives.yaml`
  - `fixtures/m7/footprints/primitives_templated.yaml`
  - `fixtures/m7/footprints/visual_arc_text.yaml`
  - `fixtures/m7/footprints/diode.yaml`
  - `fixtures/m7/footprints/button.yaml`
  - `fixtures/m7/footprints/mx_base.yaml`
  - `footprints/diode.yaml` (default search path)
  - `footprints/pad.yaml` (default search path)
  - `footprints/button.yaml` (default search path)
  - `footprints/mx_base.yaml` (default search path)
- PCB fixture validating footprint specs in KiCad output:
  - `fixtures/m7/pcbs/spec_pad.yaml`
  - `fixtures/m7/pcbs/spec_pad___pcbs_pcb.kicad_pcb`
  - `fixtures/m7/pcbs/spec_visual.yaml`
  - `fixtures/m7/pcbs/spec_visual___pcbs_pcb.kicad_pcb`
  - `fixtures/m7/pcbs/spec_kicad8_rect.yaml`
  - `fixtures/m7/pcbs/spec_kicad8_rect___pcbs_pcb.kicad_pcb`
  - `fixtures/m7/pcbs/spec_diode.yaml`
  - `fixtures/m7/pcbs/spec_diode___pcbs_pcb.kicad_pcb`
  - `fixtures/m7/pcbs/spec_pad_parity.yaml`
  - `fixtures/m7/pcbs/spec_pad_parity___pcbs_pcb.kicad_pcb`
  - `fixtures/m7/pcbs/spec_button_parity.yaml`
  - `fixtures/m7/pcbs/spec_button_parity___pcbs_pcb.kicad_pcb`
  - `fixtures/m7/pcbs/spec_mx_base_parity.yaml`
  - `fixtures/m7/pcbs/spec_mx_base_parity___pcbs_pcb.kicad_pcb`
  - Visual checks:
    - Open `fixtures/m7/pcbs/spec_visual___pcbs_pcb.kicad_pcb` and confirm arc sweeps 90° from the +X axis and the label is rotated +30° and hidden.
    - Open `fixtures/m7/pcbs/spec_kicad8_rect___pcbs_pcb.kicad_pcb` in KiCad 8 and confirm the silk rectangle is emitted as `fp_rect`.

### Upstream (Full Test Suite Import)

- Upstream repo: `git@github.com:ergogen/ergogen.git`
- Upstream commit: `8286e18f18ac064aa6d2ebca9c449bf2f6ba4d37`
- Source directory: `test/`
- Imported directories:
  - `fixtures/upstream/test/points/`
  - `fixtures/upstream/test/outlines/`
  - `fixtures/upstream/test/cases/`
  - `fixtures/upstream/test/pcbs/`
  - `fixtures/upstream/test/footprints/`
  - `fixtures/upstream/test/cli/`
- Harness:
  - `crates/ergogen-cli/tests/upstream_suite.rs` runs the imported integration fixtures against the Rust implementation, comparing points/units, points demo DXF, outlines DXF, cases JSCAD, and KiCad PCB outputs (0 skips across points/outlines/cases/pcbs/footprints).
  - `crates/ergogen-cli/tests/cli_suite.rs` exercises the upstream CLI fixtures (including logs, errors, and reference outputs) using the imported inputs below.

### Upstream CLI Fixture Inputs

- Upstream repo: `git@github.com:ergogen/ergogen.git`
- Upstream commit: `8286e18f18ac064aa6d2ebca9c449bf2f6ba4d37`
- Source directory: `test/fixtures/`
- Imported inputs:
  - `fixtures/upstream/fixtures/atreus_kle.json`
  - `fixtures/upstream/fixtures/big.yaml`
  - `fixtures/upstream/fixtures/bundle/`
  - `fixtures/upstream/fixtures/bundle.zip`
  - `fixtures/upstream/fixtures/medium.yaml`
  - `fixtures/upstream/fixtures/minimal_kle.json`
  - `fixtures/upstream/fixtures/minimal.yaml`
  - `fixtures/upstream/fixtures/minimal.yml`

### Upstream Baselines (JS ergogen outputs)

Upstream baselines are optional reference outputs generated from the JS ergogen CLI. They live under:

- `fixtures/upstream-baselines/<commit>/<fixture-name>/`

Each baseline folder should include a `MANIFEST.txt` capturing the commit, command, and generation time.

Use `scripts/update-upstream-baselines.sh <commit> <fixture-yaml> [fixture-name]` to refresh baselines.

To compare against baselines in tests, set:

- `UPSTREAM_BASELINE_DIR=fixtures/upstream-baselines/<commit>/<fixture-name>`
