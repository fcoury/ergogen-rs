# AGENTS.md

Project-specific instructions for agents working in this repo.

## Commit Message Guidelines

- Use Angular-style commit messages (e.g., `feat: ...`, `chore: ...`) and include a short detail summary in the body.

## Code hygene

- After each feature implementation, run `cargo check`, `cargo fmt --all` and `cargo clippy`.
  - Fix all the reported issues.
- Ensure all new and existing tests pass with `cargo test`.

## Output validation

- You can compare output files against reference outputs using `npx -y ergogen` for help with the command, use `npx -y ergogen --help`.
- If you need to compare DXF outputs, you can use the dxf2png command `cargo run -- dxf2png`, for help use `cargo run -- dxf2png --help`.

## Snapshot terminology + upstream baselines

- "Goldens" = outputs generated by our Rust tool, committed as fixtures.
- "Upstream baselines" = outputs generated by JS ergogen at a pinned commit.

To refresh upstream baselines:
- Use `scripts/update-upstream-baselines.sh <commit> <fixture-yaml> [fixture-name]`.
- Set `ERGOGEN_UPSTREAM_DIR` to a local clone to pin commits, or `ERGOGEN_UPSTREAM_CMD` to override the CLI.
- Outputs land in `fixtures/upstream-baselines/<commit>/<fixture-name>/` with a MANIFEST.txt.
- Optional comparisons can be run by setting `UPSTREAM_BASELINE_DIR` when running the reference output tests.
